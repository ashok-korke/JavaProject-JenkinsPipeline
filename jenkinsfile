pipeline{
agent any
tools{
maven "MAVEN"
}
stages{
     stage('Build'){
          steps{
                echo "Project building successfully...."
                checkout scmGit(branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/ashok-korke/JavaProject-JenkinsPipeline.git']])
                bat "mvn -Dmaven.test.failure.ignore=true clean package"
              }
              
    }
 stage('Static Analysis') {
    steps{
      withSonarQubeEnv('SonarQube1') 
      {
        bat 'mvn clean package sonar:sonar'
   	   echo 'Static Analysis Completed' 
      }
   }
    stage("Quality Gate"){
steps{
      timeout(time: 1, unit: 'HOURS') 
      {
        waitForQualityGate abortPipeline: true
        def qg= waitForQualityGate()
        if (qg.status!= 'OK'){
          error "Pipeline aborted due to quality gate failure: ${qg.status}"
        }
      }         
      echo 'Quality Gate Passed' 
}
    }
              
    }
    stage('deploy'){
      steps{
              echo "Project Deployed successfully....."
              deploy adapters: [tomcat9(credentialsId: '9032b316-9748-4599-9151-12bce65e6be9', path: '', url: 'http://localhost:8080/')], contextPath: 'JavaProject-JenkinsPipeline', war: '**/*.war'
           }
    }
    stage('Test'){
     steps{
           echo "Project Tested successfully......"
         }
    }
    stage('Release'){
      steps{
             echo "Project released successfully....."
           }
    }
    
}

}
